{"cells":[{"cell_type":"code","source":["!apt-get update"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"CCF3GArd1Zlo","executionInfo":{"status":"ok","timestamp":1690570176377,"user_tz":-180,"elapsed":4509,"user":{"displayName":"","userId":""}},"outputId":"cea186bf-ceb1-4939-87fe-c6daf215510e"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["\r0% [Working]\r            \rGet:1 http://security.ubuntu.com/ubuntu jammy-security InRelease [110 kB]\n","\r0% [Connecting to archive.ubuntu.com] [1 InRelease 14.2 kB/110 kB 13%] [Connect\r                                                                               \rGet:2 https://cloud.r-project.org/bin/linux/ubuntu jammy-cran40/ InRelease [3,626 B]\n","\r0% [Connecting to archive.ubuntu.com] [1 InRelease 25.8 kB/110 kB 23%] [2 InRel\r0% [Connecting to archive.ubuntu.com] [1 InRelease 69.2 kB/110 kB 63%] [Connect\r0% [Connecting to archive.ubuntu.com] [Connecting to ppa.launchpadcontent.net (\r                                                                               \rHit:3 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64  InRelease\n","\r0% [Waiting for headers] [Connecting to ppa.launchpadcontent.net (185.125.190.5\r                                                                               \rHit:4 http://archive.ubuntu.com/ubuntu jammy InRelease\n","\r0% [Waiting for headers] [Connecting to ppa.launchpadcontent.net (185.125.190.5\r                                                                               \rGet:5 http://archive.ubuntu.com/ubuntu jammy-updates InRelease [119 kB]\n","Get:6 http://archive.ubuntu.com/ubuntu jammy-backports InRelease [108 kB]\n","Get:7 http://security.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [969 kB]\n","Hit:8 https://ppa.launchpadcontent.net/c2d4u.team/c2d4u4.0+/ubuntu jammy InRelease\n","Get:9 http://security.ubuntu.com/ubuntu jammy-security/main amd64 Packages [802 kB]\n","Get:10 http://security.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [848 kB]\n","Hit:11 https://ppa.launchpadcontent.net/deadsnakes/ppa/ubuntu jammy InRelease\n","Get:12 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [1,087 kB]\n","Get:13 http://archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1,230 kB]\n","Get:14 http://archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [25.6 kB]\n","Get:15 https://ppa.launchpadcontent.net/graphics-drivers/ppa/ubuntu jammy InRelease [24.3 kB]\n","Hit:16 https://ppa.launchpadcontent.net/ubuntugis/ppa/ubuntu jammy InRelease\n","Get:17 https://ppa.launchpadcontent.net/graphics-drivers/ppa/ubuntu jammy/main amd64 Packages [35.7 kB]\n","Fetched 5,363 kB in 2s (2,690 kB/s)\n","Reading package lists... Done\n"]}]},{"cell_type":"code","source":["!pip install pyspark==3.0.1 py4j==0.10.9"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"tJxSSU211cx3","executionInfo":{"status":"ok","timestamp":1690570232615,"user_tz":-180,"elapsed":40485,"user":{"displayName":"","userId":""}},"outputId":"1353f7e1-2551-4089-8a68-42c1355e4e27"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting pyspark==3.0.1\n","  Downloading pyspark-3.0.1.tar.gz (204.2 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m204.2/204.2 MB\u001b[0m \u001b[31m2.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Collecting py4j==0.10.9\n","  Downloading py4j-0.10.9-py2.py3-none-any.whl (198 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m198.6/198.6 kB\u001b[0m \u001b[31m24.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hBuilding wheels for collected packages: pyspark\n","  Building wheel for pyspark (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for pyspark: filename=pyspark-3.0.1-py2.py3-none-any.whl size=204612226 sha256=017b2b0ea6a1c288d0c4849c4a431412ec5807ba37ec51791ed01f1d52437281\n","  Stored in directory: /root/.cache/pip/wheels/19/b0/c8/6cb894117070e130fc44352c2a13f15b6c27e440d04a84fb48\n","Successfully built pyspark\n","Installing collected packages: py4j, pyspark\n","  Attempting uninstall: py4j\n","    Found existing installation: py4j 0.10.9.7\n","    Uninstalling py4j-0.10.9.7:\n","      Successfully uninstalled py4j-0.10.9.7\n","Successfully installed py4j-0.10.9 pyspark-3.0.1\n"]}]},{"cell_type":"code","source":["!pip install findspark"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Bz7L0dw91rPc","executionInfo":{"status":"ok","timestamp":1690570249295,"user_tz":-180,"elapsed":5722,"user":{"displayName":"","userId":""}},"outputId":"bd24cf2c-a291-4b0a-f4b9-7901e41b05ad"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting findspark\n","  Downloading findspark-2.0.1-py2.py3-none-any.whl (4.4 kB)\n","Installing collected packages: findspark\n","Successfully installed findspark-2.0.1\n"]}]},{"cell_type":"code","source":["import findspark\n","findspark.init()\n","from pyspark.sql import SparkSession\n","\n","spark = SparkSession.builder.master(\"local[*]\").getOrCreate()"],"metadata":{"id":"RvjDk10p1xK4"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_data = spark.read.csv('data.csv', inferSchema=True, header=True)"],"metadata":{"id":"n7KkPtEU2GoH"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_item=spark.read.csv('item.csv', inferSchema=True, header=True)"],"metadata":{"id":"lwTaYSpn3aUz"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_data.show()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"SddqzhiA3feq","executionInfo":{"status":"ok","timestamp":1690576080419,"user_tz":-180,"elapsed":249,"user":{"displayName":"","userId":""}},"outputId":"a4a56008-e503-4a71-d3b7-ac23671c1df8"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["+----+----+------+---------+----------+----+----------+\n","|user|  id|rating|timestamp|name_month|year|      date|\n","+----+----+------+---------+----------+----+----------+\n","| 196| 242|     3|881250949|      дек.|1997|04.12.1997|\n","| 186| 302|     3|891717742|      апр.|1998|04.04.1998|\n","|  22| 377|     1|878887116|     нояб.|1997|07.11.1997|\n","| 244|  51|     2|880606923|     нояб.|1997|27.11.1997|\n","| 166| 346|     1|886397596|     февр.|1998|02.02.1998|\n","| 298| 474|     4|884182806|      янв.|1998|07.01.1998|\n","| 115| 265|     2|881171488|      дек.|1997|03.12.1997|\n","| 253| 465|     5|891628467|      апр.|1998|03.04.1998|\n","| 305| 451|     3|886324817|     февр.|1998|01.02.1998|\n","|   6|  86|     3|883603013|      дек.|1997|31.12.1997|\n","|  62| 257|     2|879372434|     нояб.|1997|12.11.1997|\n","| 286|1014|     5|879781125|     нояб.|1997|17.11.1997|\n","| 200| 222|     5|876042340|      окт.|1997|05.10.1997|\n","| 210|  40|     3|891035994|      мар.|1998|27.03.1998|\n","| 224|  29|     3|888104457|     февр.|1998|21.02.1998|\n","| 303| 785|     3|879485318|     нояб.|1997|14.11.1997|\n","| 122| 387|     5|879270459|     нояб.|1997|11.11.1997|\n","| 194| 274|     2|879539794|     нояб.|1997|14.11.1997|\n","| 291|1042|     4|874834944|     сент.|1997|21.09.1997|\n","| 234|1184|     2|892079237|      апр.|1998|08.04.1998|\n","+----+----+------+---------+----------+----+----------+\n","only showing top 20 rows\n","\n"]}]},{"cell_type":"code","source":["df_item.show()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"CA-wuOBb3lD_","executionInfo":{"status":"ok","timestamp":1690576082617,"user_tz":-180,"elapsed":282,"user":{"displayName":"","userId":""}},"outputId":"9f9062f0-4112-4679-cca3-4b0e34b57e5a"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["+---+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","| id|     Название фильма|Дата выпуска|День|Месяц| Год|Анимация|Детский|Комедия|Криминал|Документальный фильм|Драма |Фэнтези|Фильм-Нуар|Ужасы|Мюзикл|Мистика|Романтика|Научная фантастика|Триллер|Война|Вестерн|\n","+---+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","|  1|    Toy Story (1995)| 01-Jan-1995|   1|  Jan|1995|       1|      1|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|  2|    GoldenEye (1995)| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      1|    0|      0|\n","|  3|   Four Rooms (1995)| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      1|    0|      0|\n","|  4|   Get Shorty (1995)| 01-Jan-1995|   1|  Jan|1995|       0|      0|      1|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|  5|      Copycat (1995)| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       1|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      1|    0|      0|\n","|  6|Shanghai Triad (Y...| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|  7|Twelve Monkeys (1...| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 1|      0|    0|      0|\n","|  8|         Babe (1995)| 01-Jan-1995|   1|  Jan|1995|       0|      1|      1|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|  9|Dead Man Walking ...| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 10|  Richard III (1995)| 22-Jan-1996|  22|  Jan|1996|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    1|      0|\n","| 11|Seven (Se7en) (1995)| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       1|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      1|    0|      0|\n","| 12|Usual Suspects, T...| 14-Aug-1995|  14|  Aug|1995|       0|      0|      0|       1|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      1|    0|      0|\n","| 13|Mighty Aphrodite ...| 30-Oct-1995|  30|  Oct|1995|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 14|  Postino, Il (1994)| 01-Jan-1994|   1|  Jan|1994|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        1|                 0|      0|    0|      0|\n","| 15|Mr. Holland's Opu...| 29-Jan-1996|  29|  Jan|1996|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 16|French Twist (Gaz...| 01-Jan-1995|   1|  Jan|1995|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        1|                 0|      0|    0|      0|\n","| 17|From Dusk Till Da...| 05-Feb-1996|   5|  Feb|1996|       0|      0|      1|       1|                   0|     0|      0|         0|    1|     0|      0|        0|                 0|      1|    0|      0|\n","| 18|White Balloon, Th...| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 19|Antonia's Line (1...| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 20|Angels and Insect...| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        1|                 0|      0|    0|      0|\n","+---+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","only showing top 20 rows\n","\n"]}]},{"cell_type":"code","source":["df_avg = df_data.groupBy('id').avg('rating')\n","df_avg.show()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"-DAX1tiS3wo0","executionInfo":{"status":"ok","timestamp":1690576085446,"user_tz":-180,"elapsed":962,"user":{"displayName":"","userId":""}},"outputId":"85cbe981-a195-4e8b-e4e3-9780437c0e43"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["+----+------------------+\n","|  id|       avg(rating)|\n","+----+------------------+\n","| 496| 4.121212121212121|\n","| 471|3.6108597285067874|\n","| 463| 3.859154929577465|\n","| 148|          3.203125|\n","|1342|               2.5|\n","| 833| 3.204081632653061|\n","|1088| 2.230769230769231|\n","|1591|3.1666666666666665|\n","|1238|             3.125|\n","|1580|               1.0|\n","|1645|               4.0|\n","| 392|3.5441176470588234|\n","| 623| 2.923076923076923|\n","| 540| 2.511627906976744|\n","| 858|               1.0|\n","| 737| 2.983050847457627|\n","| 243|2.4393939393939394|\n","|1025|2.9318181818181817|\n","|1084| 3.857142857142857|\n","|1127| 2.909090909090909|\n","+----+------------------+\n","only showing top 20 rows\n","\n"]}]},{"cell_type":"code","source":["df_join = df_data.join(df_item, on='id', how='inner')"],"metadata":{"id":"Y5Go9Mgr6wDC"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_avg = df_genre.groupBy('id').agg(f.round(f.mean(f.col('rating')), 1).alias('mean_rating'))"],"metadata":{"id":"_xtjbH7UOuH5"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_join_avg = df_avg.join(df_item, on='id', how='inner')"],"metadata":{"id":"sMZBG2o--5Ag"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_join_avg.show()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"vI0ibKxn_foL","executionInfo":{"status":"ok","timestamp":1690577748396,"user_tz":-180,"elapsed":1275,"user":{"displayName":"","userId":""}},"outputId":"f90b7645-a970-4bb5-d719-c6ccfb5460a8"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["+----+-----------+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","|  id|mean_rating|     Название фильма|Дата выпуска|День|Месяц| Год|Анимация|Детский|Комедия|Криминал|Документальный фильм|Драма |Фэнтези|Фильм-Нуар|Ужасы|Мюзикл|Мистика|Романтика|Научная фантастика|Триллер|Война|Вестерн|\n","+----+-----------+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","| 496|        4.1|It's a Wonderful ...| 01-Jan-1946|   1|  Jan|1946|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 471|        3.6|Courage Under Fir...| 08-Mar-1996|   8|  Mar|1996|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    1|      0|\n","| 463|        3.9|Secret of Roan In...| 01-Jan-1994|   1|  Jan|1994|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 148|        3.2|Ghost and the Dar...| 11-Oct-1996|  11|  Oct|1996|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1342|        2.5|Convent, The (Con...| 14-Jun-1996|  14|  Jun|1996|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 833|        3.2|  Bulletproof (1996)| 06-Sep-1996|   6|  Sep|1996|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1088|        2.2|  Double Team (1997)| 04-Apr-1997|   4|  Apr|1997|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1591|        3.2|Duoluo tianshi (1...| 21-Jan-1998|  21|  Jan|1998|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1238|        3.1|   Full Speed (1996)| 01-Jan-1996|   1|  Jan|1996|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1580|        1.0|     Liebelei (1933)| 01-Jan-1933|   1|  Jan|1933|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        1|                 0|      0|    0|      0|\n","|1645|        4.0|Butcher Boy, The ...| 01-Jan-1998|   1|  Jan|1998|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 392|        3.5|Man Without a Fac...| 01-Jan-1993|   1|  Jan|1993|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 623|        2.9|Angels in the Out...| 01-Jan-1994|   1|  Jan|1994|       0|      1|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 540|        2.5|  Money Train (1995)| 01-Jan-1995|   1|  Jan|1995|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 858|        1.0|Amityville: Dollh...| 01-Jan-1996|   1|  Jan|1996|       0|      0|      0|       0|                   0|     0|      0|         0|    1|     0|      0|        0|                 0|      0|    0|      0|\n","| 737|        3.0|       Sirens (1994)| 01-Jan-1994|   1|  Jan|1994|       0|      0|      1|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 243|        2.4|Jungle2Jungle (1997)| 07-Mar-1997|   7|  Mar|1997|       0|      1|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1025|        2.9|Fire Down Below (...| 01-Jan-1997|   1|  Jan|1997|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      1|    0|      0|\n","|1084|        3.9|Anne Frank Rememb...| 23-Feb-1996|  23|  Feb|1996|       0|      0|      0|       0|                   1|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1127|        2.9|Truman Show, The ...| 01-Jan-1998|   1|  Jan|1998|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","+----+-----------+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","only showing top 20 rows\n","\n"]}]},{"cell_type":"code","source":["df_genre = df_join['id', 'rating',\n"," 'Анимация',\n"," 'Детский',\n"," 'Комедия',\n"," 'Криминал',\n"," 'Документальный фильм',\n"," 'Драма ',\n"," 'Фэнтези',\n"," 'Фильм-Нуар',\n"," 'Ужасы',\n"," 'Мюзикл',\n"," 'Мистика',\n"," 'Романтика',\n"," 'Научная фантастика',\n"," 'Триллер',\n"," 'Война',\n"," 'Вестерн']"],"metadata":{"id":"MMYpBnzNBGa-"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_genre.show()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"bRhSquSZFUnm","executionInfo":{"status":"ok","timestamp":1690576142738,"user_tz":-180,"elapsed":669,"user":{"displayName":"","userId":""}},"outputId":"b1f5ad39-4726-43f0-b106-ea05e5d72920"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["+----+------+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","|  id|rating|Анимация|Детский|Комедия|Криминал|Документальный фильм|Драма |Фэнтези|Фильм-Нуар|Ужасы|Мюзикл|Мистика|Романтика|Научная фантастика|Триллер|Война|Вестерн|\n","+----+------+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","| 242|     3|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 302|     3|       0|      0|      0|       1|                   0|     0|      0|         1|    0|     0|      1|        0|                 0|      1|    0|      0|\n","| 377|     1|       0|      1|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|  51|     2|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        1|                 0|      0|    1|      1|\n","| 346|     1|       0|      0|      0|       1|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 474|     4|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 1|      0|    1|      0|\n","| 265|     2|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      1|    0|      0|\n","| 465|     5|       0|      1|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        1|                 0|      0|    0|      0|\n","| 451|     3|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     1|      0|        1|                 0|      0|    0|      0|\n","|  86|     3|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 257|     2|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 1|      0|    0|      0|\n","|1014|     5|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 222|     5|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 1|      0|    0|      0|\n","|  40|     3|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|  29|     3|       0|      0|      1|       1|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 785|     3|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        1|                 0|      0|    0|      0|\n","| 387|     5|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","| 274|     2|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        1|                 0|      0|    0|      0|\n","|1042|     4|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      1|        0|                 0|      1|    0|      0|\n","|1184|     2|       0|      0|      0|       0|                   1|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","+----+------+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","only showing top 20 rows\n","\n"]}]},{"cell_type":"code","source":["import pyspark.sql.functions as f"],"metadata":{"id":"8bwpIFh5IVty"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_anime = df_genre.groupBy('Анимация').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"70sGDEk0Ffu0"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_childs = df_genre.groupBy('Детский').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"TbarlS1cJYvX"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_comedy = df_genre.groupBy('Комедия').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"p7FeeVAeKg3Q"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_crime = df_genre.groupBy('Криминал').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"Fiz2R1KFK3aF"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_doc = df_genre.groupBy('Документальный фильм').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"2IInJhRPLGZA"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_drama = df_genre.groupBy('Драма ').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"pw-fDV2QLe1k"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_fantaz = df_genre.groupBy('Фэнтези').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"EJL_90iVMXlV"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_noir = df_genre.groupBy('Фильм-Нуар').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"FVKirYb4MuIJ"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_horror = df_genre.groupBy('Ужасы').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"C3YRrsIiM7ed"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_muzic = df_genre.groupBy('Мюзикл').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"bUYhuRIdNPDW"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_mystic = df_genre.groupBy('Мистика').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"mF_vpG8_Nb2A"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_rom = df_genre.groupBy('Романтика').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"cOr34LIHNtu0"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_sifi = df_genre.groupBy('Научная фантастика').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"-aXKsnIIN80K"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_trill = df_genre.groupBy('Триллер').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"htfRTy_iOQ8m"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_war= df_genre.groupBy('Война').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"Emz6R4XpPoTx"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_west = df_genre.groupBy('Вестерн').agg(f.round(f.mean(f.col('rating')), 2).alias('Mean'))"],"metadata":{"id":"wf9z5lqWP0vm"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df_west.show(1)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"MS7Gq28RJArP","executionInfo":{"status":"ok","timestamp":1690578224985,"user_tz":-180,"elapsed":1747,"user":{"displayName":"","userId":""}},"outputId":"37399993-19b7-46c5-99b5-3cd9e5d55a31"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["+-------+----+\n","|Вестерн|Mean|\n","+-------+----+\n","|      1|3.61|\n","+-------+----+\n","only showing top 1 row\n","\n"]}]},{"cell_type":"code","source":["df_join_avg.orderBy('mean_rating').show(5)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"RRsR3W1VRvzf","executionInfo":{"status":"ok","timestamp":1690577771952,"user_tz":-180,"elapsed":3244,"user":{"displayName":"","userId":""}},"outputId":"aed324b8-17c4-476f-f474-eb6f044446a2"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["+----+-----------+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","|  id|mean_rating|     Название фильма|Дата выпуска|День|Месяц| Год|Анимация|Детский|Комедия|Криминал|Документальный фильм|Драма |Фэнтези|Фильм-Нуар|Ужасы|Мюзикл|Мистика|Романтика|Научная фантастика|Триллер|Война|Вестерн|\n","+----+-----------+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","|1352|        1.0|Shadow of Angels ...| 01-Jan-1976|   1|  Jan|1976|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1618|        1.0|King of New York ...| 01-Jan-1990|   1|  Jan|1990|       0|      0|      0|       1|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1339|        1.0|Stefano Quantesto...| 01-Jan-1993|   1|  Jan|1993|       0|      0|      1|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1580|        1.0|     Liebelei (1933)| 01-Jan-1933|   1|  Jan|1933|       0|      0|      0|       0|                   0|     0|      0|         0|    0|     0|      0|        1|                 0|      0|    0|      0|\n","| 858|        1.0|Amityville: Dollh...| 01-Jan-1996|   1|  Jan|1996|       0|      0|      0|       0|                   0|     0|      0|         0|    1|     0|      0|        0|                 0|      0|    0|      0|\n","+----+-----------+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","only showing top 5 rows\n","\n"]}]},{"cell_type":"code","source":["df_join_avg.sort('mean_rating', ascending=False).show(5)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"jvAHrwKXScmk","executionInfo":{"status":"ok","timestamp":1690577875568,"user_tz":-180,"elapsed":3681,"user":{"displayName":"","userId":""}},"outputId":"6899adf9-a19d-4a0c-f62a-71d2d2272482"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["+----+-----------+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","|  id|mean_rating|     Название фильма|Дата выпуска|День|Месяц| Год|Анимация|Детский|Комедия|Криминал|Документальный фильм|Драма |Фэнтези|Фильм-Нуар|Ужасы|Мюзикл|Мистика|Романтика|Научная фантастика|Триллер|Война|Вестерн|\n","+----+-----------+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","|1122|        5.0|They Made Me a Cr...| 01-Jan-1939|   1|  Jan|1939|       0|      0|      0|       1|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1500|        5.0|Santa with Muscle...| 08-Nov-1996|   8|  Nov|1996|       0|      0|      1|       0|                   0|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1599|        5.0|Someone Else's Am...| 10-May-1996|  10|  May|1996|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1653|        5.0|Entertaining Ange...| 27-Sep-1996|  27|  Sep|1996|       0|      0|      0|       0|                   0|     1|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","|1201|        5.0|Marlene Dietrich:...| 02-Apr-1996|   2|  Apr|1996|       0|      0|      0|       0|                   1|     0|      0|         0|    0|     0|      0|        0|                 0|      0|    0|      0|\n","+----+-----------+--------------------+------------+----+-----+----+--------+-------+-------+--------+--------------------+------+-------+----------+-----+------+-------+---------+------------------+-------+-----+-------+\n","only showing top 5 rows\n","\n"]}]}],"metadata":{"colab":{"provenance":[{"file_id":"/v2/external/notebooks/snippets/importing_libraries.ipynb","timestamp":1690578242529}]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}